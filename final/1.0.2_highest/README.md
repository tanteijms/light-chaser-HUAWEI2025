# 1.0.2v

## 从1.0v的优化

1. 批处理大小优化

   新增calculate_efficiency和calculate_optimal_batch函数，根据推理速度系数和批处理大小的关系，计算最佳批处理大小

   unordered_map缓存批处理效率计算结果，避免重复计算

2. 用户紧急程度评估

   urgency属性，update_user_urgency函数，根据剩余样本数量与剩余时间的比例，计算用户紧急程度

   优先处理紧急程度高的用户请求

3. NPU负载均衡

   utilization属性，追踪每个NPU的使用率

   计算成本时考虑NPU的使用率，促进负载均衡

4. 动态调度策略

   根据截止时间调整任务优先级，对接近或超过截止时间的任务增加优先级

   deadline_factor动态调整成本计算，确保在截止时间内完成任务

5. NPU选择优化

   按空闲时间对NPU进行排序，优先选择更早空闲的NPU

   减少对NPU的无序遍历，提高查找效率

6. 算法鲁棒性

   当找不到可调度请求时，跳转到下一个可能的调度时间点

   修复可能导致无限循环

7. 最佳迁移惩罚值 = 20（在1.0v基础上试出来的，目前为在1.0.2v优化后进行调整尝试，经验值）